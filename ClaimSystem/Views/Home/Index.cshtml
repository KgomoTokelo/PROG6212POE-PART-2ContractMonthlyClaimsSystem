@model IEnumerable<ClaimSystem.Models.Claim>

@{
    ViewBag.Title = "Monthly Contract Claim System Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";

    // Safe null-check for Model
    var totalClaims = Model?.Count() ?? 0;
    var verifiedClaims = Model?.Count(c => c.Status == ClaimSystem.Models.Claim.status.Verefied) ?? 0;
    var pendingClaims = Model?.Count(c => c.Status == ClaimSystem.Models.Claim.status.Submitted) ?? 0;
    var approvedClaims = Model?.Count(c => c.Status == ClaimSystem.Models.Claim.status.Approved) ?? 0;
    var rejectedClaims = Model?.Count(c => c.Status == ClaimSystem.Models.Claim.status.Rejected || c.Status == ClaimSystem.Models.Claim.status.Decline) ?? 0;
    var totalAmount = Model?.Sum(c => c.HoursWorked * (double)c.HourlyRate) ?? 0;
}

<h2 class="mb-4">📊 Monthly Contract Claim System - Dashboard</h2>

@if (ViewBag.ErrorMessage != null)
{
    <div class="alert alert-danger">@ViewBag.ErrorMessage</div>
}

<div class="d-flex flex-wrap gap-4 mt-3">

    <!-- Card: Total Claims -->
    <div class="flex-fill p-4 rounded shadow-sm bg-light">
        <h5>Total Claims</h5>
        <p class="fs-3 fw-bold text-primary">@totalClaims</p>
    </div>

    <!-- Card: Verified Claims -->
    <div class="flex-fill p-4 rounded shadow-sm" style="background-color: #d1e7dd;">
        <h5>Verified Claims</h5>
        <p class="fs-3 fw-bold text-success">@verifiedClaims</p>
    </div>

    <!-- Card: Pending Claims -->
    <div class="flex-fill p-4 rounded shadow-sm" style="background-color: #fff3cd;">
        <h5>Pending Claims</h5>
        <p class="fs-3 fw-bold text-warning">@pendingClaims</p>
    </div>

    <!-- Card: Approved Claims -->
    <div class="flex-fill p-4 rounded shadow-sm" style="background-color: #cfe2ff;">
        <h5>Approved Claims</h5>
        <p class="fs-3 fw-bold text-primary">@approvedClaims</p>
    </div>

    <!-- Card: Total Amount -->
    <div class="flex-fill p-4 rounded shadow-sm" style="background-color: #f8d7da;">
        <h5>Total Amount Claimed</h5>
        <p class="fs-3 fw-bold text-danger">R @totalAmount.ToString("N2")</p>
    </div>
</div>

<!-- Recent Claims Table -->
<div class="mt-5">
    <h3>🕓 Recent Claims</h3>

    @if (Model == null || !Model.Any())
    {
        <div class="alert alert-info mt-3">No claims found.</div>
    }
    else
    {
        <table class="table table-striped mt-3">
            <thead class="table-primary">
                <tr>
                    <th>Claim ID</th>
                    <th>Lecturer</th>
                    <th>Module</th>
                    <th>Status</th>
                    <th>Month</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var claim in Model.OrderByDescending(c => c.SubmissionDate).Take(5))
                {
                    <tr>
                        <td>@claim.ClaimID</td>
                        <td>@claim.Lecturer?.Name</td>
                        <td>@claim.ModuleName</td>
                        <td>
                            <span class="badge
                                        @(claim.Status == ClaimSystem.Models.Claim.status.Approved ? "bg-success" :
                                                                    claim.Status == ClaimSystem.Models.Claim.status.Submitted ? "bg-info" :
                                                                    claim.Status == ClaimSystem.Models.Claim.status.Rejected || claim.Status == ClaimSystem.Models.Claim.status.Decline ? "bg-danger" :
                                                                    claim.Status == ClaimSystem.Models.Claim.status.Verefied ? "bg-primary" :
                                                                    "bg-secondary")">
                        @claim.Status
                    </span>
                </td>
                <td>@claim.SubmissionDate.ToString("MMMM")</td>
                <td>R @((claim.HoursWorked * (double)claim.HourlyRate).ToString("N2"))</td>
            </tr>
                        }
            </tbody>
        </table>
    }
</div>

<!-- Quick Actions -->
<div class="mt-5">
    <h3>⚙️ Quick Actions</h3>
    <div class="d-flex gap-3 mt-3">
        <a asp-action="CreateClaim" class="btn btn-success">
            <i class="bi bi-plus-circle"></i> Add New Claim
        </a>
        <a asp-controller="Approve" asp-action="Verify" class="btn btn-warning text-white">
            <i class="bi bi-check2-circle"></i> Verify Claims
        </a>
        <a asp-controller="Report" asp-action="Generate" class="btn btn-info text-white">
            <i class="bi bi-bar-chart"></i> Generate Report
        </a>
    </div>
</div>
